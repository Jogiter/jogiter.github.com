<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wechat save and share image | Jogiter`s mind</title>
    <meta name="description" content="EveryThing about Me!">
    <link rel="stylesheet" href="/assets/style.d7f2fbcd.css">
    <link rel="modulepreload" href="/assets/plugin-vue_export-helper.71bb0c0b.js">
    <link rel="modulepreload" href="/assets/Home.4b66fb27.js">
    <link rel="modulepreload" href="/assets/AlgoliaSearchBox.4fd3e7bf.js">
    <link rel="modulepreload" href="/assets/tech_wechat-save-and-share-image.md.3e87f2ee.lean.js">
    <link rel="modulepreload" href="/assets/app.9366d4db.js">
    <meta name="twitter:title" content="wechat save and share image | Jogiter`s mind">
    <meta property="og:title" content="wechat save and share image | Jogiter`s mind">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7b01b921><div class="sidebar-button" data-v-7b01b921><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Jogiter`s mind, back to home" data-v-7b01b921 data-v-19158655><!----> Jogiter`s mind</a><div class="flex-grow" data-v-7b01b921></div><div class="nav" data-v-7b01b921><nav class="nav-links" data-v-7b01b921 data-v-043d24b5><!--[--><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/about/" data-v-33cbaa06>个人简介 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/reading/" data-v-33cbaa06>Awesome 学习链接 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>杂文</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/books-to-read" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>books-to-read</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/rework" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>rework</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/the-21-laws-of-leadership" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>the-21-laws-of-leadership</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>情感</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/emotion/当人们让你失望时，有6种方法可以照顾好自己" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>当人们让你失望时，有6种方法可以照顾好自己</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>社交账号</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="https://github.com/Jogiter" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>Github</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="mailto:jogiter.g@gmail.com" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>邮箱</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item isExternal" href="https://github.com/Jogiter/jogiter.github.com" target="_blank" rel="noopener noreferrer" data-v-33cbaa06>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-33cbaa06><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-219eda98><nav class="nav-links nav" data-v-219eda98 data-v-043d24b5><!--[--><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/about/" data-v-33cbaa06>个人简介 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/reading/" data-v-33cbaa06>Awesome 学习链接 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>杂文</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/books-to-read" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>books-to-read</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/rework" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>rework</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/the-21-laws-of-leadership" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>the-21-laws-of-leadership</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>情感</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/emotion/当人们让你失望时，有6种方法可以照顾好自己" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>当人们让你失望时，有6种方法可以照顾好自己</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>社交账号</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="https://github.com/Jogiter" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>Github</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="mailto:jogiter.g@gmail.com" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>邮箱</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item isExternal" href="https://github.com/Jogiter/jogiter.github.com" target="_blank" rel="noopener noreferrer" data-v-33cbaa06>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-33cbaa06><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-219eda98><!--[--><li class="sidebar-link"><p class="sidebar-link-item">文章</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/AIGC视频字幕">AIGC视频字幕</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/DDD">DDD</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/Nodejs-权威指南">Nodejs-权威指南</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/Typescript-guides">Typescript-guides</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/eventloop-task-and-microtasks">eventloop-task-and-microtasks</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/fetch-API">fetch-API</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/ffmpeg">ffmpeg</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/font-face">font-face</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/frontend-optimization">frontend-optimization</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/git-tutorial">git-tutorial</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/higher-order-function">higher-order-function</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/i18n">i18n</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/jsonp-vs-cors">jsonp-vs-cors</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/lerna-with-tsdx">lerna-with-tsdx</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/macbook-开发环境配置">macbook-开发环境配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/markdown 解析及语法高亮调研">markdown 解析及语法高亮调研</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/mediaSourceExtension">mediaSourceExtension</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/nest.js and typeOrm">nest.js and typeOrm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/pwa">pwa</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/string-compare">string-compare</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/taro 小程序开发入门指北">taro 小程序开发入门指北</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/tdd">tdd</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/using-virtualbox-test-old-ie">using-virtualbox-test-old-ie</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/vue2-composition-api-faq">vue2-composition-api-faq</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/webpack-config">webpack-config</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/webrtc">webrtc</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/wechat-save-and-share-image">wechat-save-and-share-image</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】CentOS 8 服务器初始化设置">【译】CentOS 8 服务器初始化设置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】什么是 Web3">【译】什么是 Web3</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】在-centeros8-上部署Node-js应用程序">【译】在-centeros8-上部署Node-js应用程序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【转】Javascript中的8种常见数据结构">【转】Javascript中的8种常见数据结构</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/使用-uni-app-开发小程序">使用-uni-app-开发小程序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/博客添加docSearch">博客添加docSearch</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/打造舒适高效的前端开发环境">打造舒适高效的前端开发环境</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/搭建私有-npm">搭建私有-npm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/移动端适配">移动端适配</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-1881bce0><div class="container" data-v-1881bce0><!--[--><!--]--><div style="position:relative;" class="content" data-v-1881bce0><div><h1 id="frontmatter-title" tabindex="-1">wechat save and share image <a class="header-anchor" href="#frontmatter-title" aria-hidden="true">#</a></h1><p><div class="table-of-contents"><ul><li><a href="#discover-the-different-features-supported-by-html2canvas">Discover the different features supported by html2canvas</a></li><li><a href="#_3-2-2-图片画出来怎么不见了">3.2.2 图片画出来怎么不见了</a></li><li><a href="#canvas-绘制模糊">canvas 绘制模糊</a></li><li><a href="#阅读链接">阅读链接</a></li></ul></div></p><p>参考 <a href="https://juejin.im/post/5a17c5e26fb9a04527254689" target="_blank" rel="noopener noreferrer">一次 H5 「保存页面为图片」 的踩坑之旅</a> 可以完成 90% 的工作量。项目主要用到的是 <a href="https://html2canvas.hertzen.com/configuration" target="_blank" rel="noopener noreferrer">html2canvas</a>。</p><p><a href="https://blog.jogiter.cn/test/html2canvas/" target="_blank" rel="noopener noreferrer">online demo</a></p><h2 id="discover-the-different-features-supported-by-html2canvas" tabindex="-1"><a href="http://html2canvas.hertzen.com/features" target="_blank" rel="noopener noreferrer">Discover the different features supported by html2canvas</a> <a class="header-anchor" href="#discover-the-different-features-supported-by-html2canvas" aria-hidden="true">#</a></h2><p><strong>Unsupported CSS properties</strong></p><p>These CSS properties are NOT currently supported</p><ul><li>background-blend-mode</li><li>border-image</li><li>box-decoration-break</li><li>box-shadow</li><li>filter</li><li>font-variant-ligatures</li><li>mix-blend-mode</li><li>object-fit</li><li>repeating-linear-gradient()</li><li>writing-mode</li><li>zoom</li></ul><h2 id="_3-2-2-图片画出来怎么不见了" tabindex="-1"><a href="https://juejin.im/post/5a17c5e26fb9a04527254689" target="_blank" rel="noopener noreferrer">3.2.2 图片画出来怎么不见了</a> <a class="header-anchor" href="#_3-2-2-图片画出来怎么不见了" aria-hidden="true">#</a></h2><blockquote><p>什么是“被污染”的 canvas?</p><p>尽管不通过 CORS 就可以在画布中使用图片，但是这会污染画布。一旦画布被污染，你就无法读取其数据。例如，你不能再使用画布的 toBlob(), toDataURL() 或 getImageData() 方法，调用它们会抛出安全错误。</p></blockquote><p><strong>方案一：将图片转换成 base64</strong></p><p>前提条件：</p><ul><li>给 img 元素设置 crossOrigin 属性，值为 anonymous</li><li>图片服务端设置允许跨域（返回 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreferrer">CORS</a> 头）</li></ul><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> outputFormat</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">&#39;Anonymous&#39;</span>
  img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;CANVAS&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> dataURL
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>naturalHeight
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>naturalWidth
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    dataURL <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span>outputFormat<span class="token punctuation">)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>dataURL<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> src
  <span class="token keyword">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>complete <span class="token operator">||</span> img<span class="token punctuation">.</span>complete <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span>
      <span class="token string">&#39;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==&#39;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">toDataURL</span><span class="token punctuation">(</span>
  <span class="token string">&#39;https://www.gravatar.com/avatar/d50c83cc0c6523b4d3f6085295c953e0&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dataUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;RESULT:&#39;</span><span class="token punctuation">,</span> dataUrl<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p><strong>方案二：<code>html2canvas</code> 开启 <code>useCORS</code>(Whether to attempt to load images from a server using CORS)</strong></p><div class="language-js"><pre><code><span class="token function">html2canvas</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">useCORS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appenChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="canvas-绘制模糊" tabindex="-1">canvas 绘制模糊 <a class="header-anchor" href="#canvas-绘制模糊" aria-hidden="true">#</a></h2><p><strong>1.canvas 锯齿</strong></p><p>修改 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/imageSmoothingEnabled" target="_blank" rel="noopener noreferrer">imageSmoothingEnabled</a> 值</p><blockquote><p>CanvasRenderingContext2D.imageSmoothingEnabled 是 Canvas 2D API 用来设置图片是否平滑的属性，true 表示图片平滑（默认值），false 表示图片不平滑。当我们获取 imageSmoothingEnabled 属性值时， 它会返回最新设置的值。</p></blockquote><blockquote><p>以缩放画布为例，这个属性对像素为主的游戏很有用。默认的改变大小的算法会造成图片模糊并且破坏图片原有的像素。 如果那样的话，设置属性值为 false。</p></blockquote><div class="language-js"><pre><code><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// ios 会报错: The operation is insecure.</span>
img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">&#39;anonymous&#39;</span>
img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>mozImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
  ctx<span class="token punctuation">.</span>webkitImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
  ctx<span class="token punctuation">.</span>msImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
  ctx<span class="token punctuation">.</span>imageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span>

  <span class="token comment">// 浏览器为了达到抗锯齿的效果会做额外的运算。为了避免这种情况，请保证在你调用 drawImage() 函数时，</span>
  <span class="token comment">// 用 Math.floor() 函数对所有的坐标点取整。</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;https://mdn.mozillademos.org/files/222/Canvas_createpattern.png&#39;</span>
</code></pre></div><p><strong>2.解决 Retina 屏下的 图片模糊问题</strong></p><p><a href="https://www.html5rocks.com/en/tutorials/canvas/hidpi/" target="_blank" rel="noopener noreferrer">High DPI Canvas</a></p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">setupCanvas</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get the device pixel ratio, falling back to 1.</span>
  <span class="token keyword">var</span> dpr <span class="token operator">=</span> window<span class="token punctuation">.</span>devicePixelRatio <span class="token operator">||</span> <span class="token number">1</span>
  <span class="token comment">// Get the size of the canvas in CSS pixels.</span>
  <span class="token keyword">var</span> rect <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Give the canvas pixel dimensions of their CSS</span>
  <span class="token comment">// size * the device pixel ratio.</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> rect<span class="token punctuation">.</span>width <span class="token operator">*</span> dpr
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> rect<span class="token punctuation">.</span>height <span class="token operator">*</span> dpr
  <span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// Scale all drawing operations by the dpr, so you</span>
  <span class="token comment">// don&#39;t have to worry about the difference.</span>
  ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>dpr<span class="token punctuation">,</span> dpr<span class="token punctuation">)</span>
  <span class="token keyword">return</span> ctx
<span class="token punctuation">}</span>

<span class="token comment">// Now this line will be the same size on the page</span>
<span class="token comment">// but will look sharper on high-DPI devices!</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> <span class="token function">setupCanvas</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.my-canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5</span>
ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>3.移动端 zoom 适配问题</strong></p><p>项目中遇到了重构用了 <code>zoom</code> 来自适应，但是根据 <a href="http://html2canvas.hertzen.com/features" target="_blank" rel="noopener noreferrer">Discover the different features supported by html2canvas</a> 目前是不支持 <code>zoom</code> 属性的。可以使用 <code>transform: scale(0.5, 0.5)</code> 来替换 <code>zoom</code></p><h2 id="阅读链接" tabindex="-1">阅读链接 <a class="header-anchor" href="#阅读链接" aria-hidden="true">#</a></h2><ul><li><a href="https://html2canvas.hertzen.com/configuration" target="_blank" rel="noopener noreferrer">html2canvas</a></li><li><a href="https://www.html5rocks.com/en/tutorials/canvas/hidpi/" target="_blank" rel="noopener noreferrer">High DPI Canvas</a></li><li><a href="https://juejin.im/post/5a17c5e26fb9a04527254689" target="_blank" rel="noopener noreferrer">一次 H5 「保存页面为图片」 的踩坑之旅</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image" target="_blank" rel="noopener noreferrer">启用了 CORS 的图片</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener noreferrer">浏览器的同源策略</a></li><li><a href="https://stackoverflow.com/questions/6150289/how-to-convert-image-into-base64-string-using-javascript" target="_blank" rel="noopener noreferrer">将图像转换为 base64</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener noreferrer">CanvasRenderingContext2D</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas" target="_blank" rel="noopener noreferrer">canvas 的优化</a></li></ul></div></div><footer class="page-footer" data-v-1881bce0 data-v-001a5369><div class="edit" data-v-001a5369><div class="edit-link" data-v-001a5369 data-v-6dc6f5be><a class="link" href="https://github.com/Jogiter/jogiter.github.com/edit/vitepress/docs/tech/wechat-save-and-share-image.md" target="_blank" rel="noopener noreferrer" data-v-6dc6f5be>在GitHub上编辑此页面 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-6dc6f5be><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-001a5369><p class="last-updated" data-v-001a5369 data-v-6a1b94eb><span class="prefix" data-v-6a1b94eb>最后更新:</span><span class="datetime" data-v-6a1b94eb></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"about_index.md\":\"d55595f5\",\"emotion_当人们让你失望时，有6种方法可以照顾好自己.md\":\"7dfa4c4f\",\"essay_books-to-read.md\":\"b6f41046\",\"essay_rework.md\":\"7eb94c11\",\"essay_the-21-laws-of-leadership.md\":\"967cb692\",\"index.md\":\"7f17cfc4\",\"reading_index.md\":\"a0513ac5\",\"tech_aigc视频字幕.md\":\"871ee7c6\",\"tech_ddd.md\":\"bb89399c\",\"tech_nodejs-权威指南.md\":\"7660e35a\",\"tech_typescript-guides.md\":\"1ea40208\",\"tech_eventloop-task-and-microtasks.md\":\"3c630f35\",\"tech_fetch-api.md\":\"7095eb06\",\"tech_ffmpeg.md\":\"6069ea4f\",\"tech_font-face.md\":\"1a828ba5\",\"tech_frontend-optimization.md\":\"96710ebb\",\"tech_git-tutorial.md\":\"3bd599b0\",\"tech_higher-order-function.md\":\"24ed6853\",\"tech_i18n.md\":\"a6186cce\",\"tech_index.md\":\"5cccff1b\",\"tech_jsonp-vs-cors.md\":\"d48e5903\",\"tech_lerna-with-tsdx.md\":\"8042ae6c\",\"tech_macbook-开发环境配置.md\":\"98c14f2b\",\"tech_markdown 解析及语法高亮调研.md\":\"ec8b4dc8\",\"tech_mediasourceextension.md\":\"6e13e86e\",\"tech_nest.js and typeorm.md\":\"75fed2f2\",\"tech_pwa.md\":\"def529c2\",\"tech_string-compare.md\":\"e1abbf7e\",\"tech_taro 小程序开发入门指北.md\":\"2ca8479c\",\"tech_tdd.md\":\"4a5984e7\",\"tech_using-virtualbox-test-old-ie.md\":\"0eab56d5\",\"tech_vue2-composition-api-faq.md\":\"ff0d1c27\",\"tech_webpack-config.md\":\"65485614\",\"tech_webrtc.md\":\"e50576f2\",\"tech_wechat-save-and-share-image.md\":\"3e87f2ee\",\"tech_【译】centos 8 服务器初始化设置.md\":\"ef4643d0\",\"tech_【译】什么是 web3.md\":\"830bb3cb\",\"tech_【译】在-centeros8-上部署node-js应用程序.md\":\"f64f4864\",\"tech_【转】javascript中的8种常见数据结构.md\":\"5d216184\",\"tech_使用-uni-app-开发小程序.md\":\"e7f78bbd\",\"tech_博客添加docsearch.md\":\"ca15e5df\",\"tech_打造舒适高效的前端开发环境.md\":\"cbd52576\",\"tech_搭建私有-npm.md\":\"71461f0c\",\"tech_移动端适配.md\":\"48d0a999\"}")</script>
    <script type="module" async src="/assets/app.9366d4db.js"></script>
    
  </body>
</html>