<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mediaSourceExtension | Jogiter`s mind</title>
    <meta name="description" content="EveryThing about Me!">
    <link rel="stylesheet" href="/assets/style.d7f2fbcd.css">
    <link rel="modulepreload" href="/assets/plugin-vue_export-helper.71bb0c0b.js">
    <link rel="modulepreload" href="/assets/Home.4b66fb27.js">
    <link rel="modulepreload" href="/assets/AlgoliaSearchBox.4fd3e7bf.js">
    <link rel="modulepreload" href="/assets/tech_mediaSourceExtension.md.6e13e86e.lean.js">
    <link rel="modulepreload" href="/assets/app.9366d4db.js">
    <meta name="twitter:title" content="mediaSourceExtension | Jogiter`s mind">
    <meta property="og:title" content="mediaSourceExtension | Jogiter`s mind">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7b01b921><div class="sidebar-button" data-v-7b01b921><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Jogiter`s mind, back to home" data-v-7b01b921 data-v-19158655><!----> Jogiter`s mind</a><div class="flex-grow" data-v-7b01b921></div><div class="nav" data-v-7b01b921><nav class="nav-links" data-v-7b01b921 data-v-043d24b5><!--[--><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/about/" data-v-33cbaa06>个人简介 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/reading/" data-v-33cbaa06>Awesome 学习链接 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>杂文</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/books-to-read" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>books-to-read</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/rework" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>rework</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/the-21-laws-of-leadership" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>the-21-laws-of-leadership</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>情感</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/emotion/当人们让你失望时，有6种方法可以照顾好自己" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>当人们让你失望时，有6种方法可以照顾好自己</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>社交账号</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="https://github.com/Jogiter" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>Github</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="mailto:jogiter.g@gmail.com" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>邮箱</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item isExternal" href="https://github.com/Jogiter/jogiter.github.com" target="_blank" rel="noopener noreferrer" data-v-33cbaa06>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-33cbaa06><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-219eda98><nav class="nav-links nav" data-v-219eda98 data-v-043d24b5><!--[--><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/about/" data-v-33cbaa06>个人简介 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/reading/" data-v-33cbaa06>Awesome 学习链接 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>杂文</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/books-to-read" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>books-to-read</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/rework" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>rework</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/the-21-laws-of-leadership" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>the-21-laws-of-leadership</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>情感</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/emotion/当人们让你失望时，有6种方法可以照顾好自己" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>当人们让你失望时，有6种方法可以照顾好自己</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>社交账号</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="https://github.com/Jogiter" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>Github</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="mailto:jogiter.g@gmail.com" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>邮箱</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item isExternal" href="https://github.com/Jogiter/jogiter.github.com" target="_blank" rel="noopener noreferrer" data-v-33cbaa06>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-33cbaa06><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-219eda98><!--[--><li class="sidebar-link"><p class="sidebar-link-item">文章</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/AIGC视频字幕">AIGC视频字幕</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/DDD">DDD</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/Nodejs-权威指南">Nodejs-权威指南</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/Typescript-guides">Typescript-guides</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/eventloop-task-and-microtasks">eventloop-task-and-microtasks</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/fetch-API">fetch-API</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/ffmpeg">ffmpeg</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/font-face">font-face</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/frontend-optimization">frontend-optimization</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/git-tutorial">git-tutorial</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/higher-order-function">higher-order-function</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/i18n">i18n</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/jsonp-vs-cors">jsonp-vs-cors</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/lerna-with-tsdx">lerna-with-tsdx</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/macbook-开发环境配置">macbook-开发环境配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/markdown 解析及语法高亮调研">markdown 解析及语法高亮调研</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/mediaSourceExtension">mediaSourceExtension</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/nest.js and typeOrm">nest.js and typeOrm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/pwa">pwa</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/string-compare">string-compare</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/taro 小程序开发入门指北">taro 小程序开发入门指北</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/tdd">tdd</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/using-virtualbox-test-old-ie">using-virtualbox-test-old-ie</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/vue2-composition-api-faq">vue2-composition-api-faq</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/webpack-config">webpack-config</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/webrtc">webrtc</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/wechat-save-and-share-image">wechat-save-and-share-image</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】CentOS 8 服务器初始化设置">【译】CentOS 8 服务器初始化设置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】什么是 Web3">【译】什么是 Web3</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】在-centeros8-上部署Node-js应用程序">【译】在-centeros8-上部署Node-js应用程序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【转】Javascript中的8种常见数据结构">【转】Javascript中的8种常见数据结构</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/使用-uni-app-开发小程序">使用-uni-app-开发小程序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/博客添加docSearch">博客添加docSearch</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/打造舒适高效的前端开发环境">打造舒适高效的前端开发环境</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/搭建私有-npm">搭建私有-npm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/移动端适配">移动端适配</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-1881bce0><div class="container" data-v-1881bce0><!--[--><!--]--><div style="position:relative;" class="content" data-v-1881bce0><div><h1 id="frontmatter-title" tabindex="-1">mediaSourceExtension <a class="header-anchor" href="#frontmatter-title" aria-hidden="true">#</a></h1><p><div class="table-of-contents"><ul><li><a href="#demo">demo</a></li><li><a href="#使用-url-createobjecturl-blob-创建-blob-url">使用 URL.createObjectURL(blob) 创建 Blob URL</a></li><li><a href="#media-source-extensions">Media Source Extensions</a><ul><li><a href="#html-的媒体支持浏览器兼容情况">HTML 的媒体支持浏览器兼容情况</a></li><li><a href="#transcoding">transcoding</a></li><li><a href="#获取资源的-codecs-及资源碎片化">获取资源的 codecs 及资源碎片化</a></li><li><a href="#使用-mse-播放二进制数据流">使用 MSE 播放二进制数据流</a></li><li><a href="#注意">注意</a></li></ul></li><li><a href="#阅读链接">阅读链接</a></li></ul></div></p><h2 id="demo" tabindex="-1">demo <a class="header-anchor" href="#demo" aria-hidden="true">#</a></h2><p>在 <a href="http://live.xunlei.com/" target="_blank" rel="noopener noreferrer">迅雷直播</a> 中审查元素，可以看到视频元素会看到它的 src 是一个 <a href="https://www.w3.org/TR/FileAPI/#url" target="_blank" rel="noopener noreferrer">Blob URL</a>。</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span>
  <span class="token attr-name">preload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>metadata<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>blob:http://live.xunlei.com/79a71646-6b99-419c-a3c3-d7c171266aca<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>与普通的 html5 video 的区别</strong></p><ol><li>直接访问 <code>src</code> 的链接，无法播放视频</li><li>无法右键保存到本地</li></ol><table><thead><tr><th style="text-align:left;">使用 html5 video</th><th style="text-align:left;">使用 MSE</th></tr></thead><tbody><tr><td style="text-align:left;"><img src="https://img.cdn.jogiter.cn/public/blog/rightmouse-video.png" alt="使用 html5 video"></td><td style="text-align:left;"><img src="https://img.cdn.jogiter.cn/public/blog/rightmouse-mse.png" alt="使用 MSE"></td></tr></tbody></table><ol start="3"><li>支持分片加载，加快视频打开速度，节省流量</li></ol><p>比如打开一个 <code>197 MB</code> 的视频文件，使用分片加载用户体验会更好。</p><p>一次性加载完毕</p><p><img src="https://img.cdn.jogiter.cn/public/blog/bufferAll.gif" alt="bufferAll"></p><p>分片加载，每次加载一部分</p><p><img src="https://img.cdn.jogiter.cn/public/blog/bufferWhenNeeded.gif" alt="bufferWhenNeeded"></p><h2 id="使用-url-createobjecturl-blob-创建-blob-url" tabindex="-1">使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URL/createObjectURL#Example" target="_blank" rel="noopener noreferrer">URL.createObjectURL(blob)</a> 创建 Blob URL <a class="header-anchor" href="#使用-url-createobjecturl-blob-创建-blob-url" aria-hidden="true">#</a></h2><p>在每次调用 <code>createObjectURL()</code> 方法时，都会创建一个新的 <code>URL</code> 对象，即使你已经用相同的对象作为参数创建过。当不再需要这些 URL 对象时，每个对象必须通过调用 <code>URL.revokeObjectURL()</code> 方法来释放。浏览器会在文档退出的时候自动释放它们，但是为了获得最佳性能和内存使用状况，你应该在安全的时机主动释放掉它们。</p><div class="language-js"><pre><code><span class="token comment">// blob = scheme &quot;:&quot; origin &quot;/&quot; UUID</span>
<span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;image/png&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> url
img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token comment">// &lt;img src=&quot;blob:https://developer.mozilla.org/0495d5c4-5b70-4960-8bdb-3b761d3b1c56&quot;&gt;</span>
</code></pre></div><p><strong>createObjectURL 的兼容性</strong></p><p><img src="https://img.cdn.jogiter.cn/public/blog/createObjectURL.png" alt="caniuse?search=createObjectURL"></p><p><a href="https://codepen.io/pen/" target="_blank" rel="noopener noreferrer">demo</a>，更多例子参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File/Using_files_from_web_applications" target="_blank" rel="noopener noreferrer">使用 Web 应用程序中的文件</a></p><h2 id="media-source-extensions" tabindex="-1">Media Source Extensions <a class="header-anchor" href="#media-source-extensions" aria-hidden="true">#</a></h2><p>允许 <code>JavaScript</code> 动态构建 <code>&lt;audio&gt;</code> 和 <code>&lt;video&gt;</code> 的媒体流。它定义了一个 <code>MediaSource</code> 对象，可以作为 <code>HTMLMediaElement</code> 的媒体数据源。 <code>MediaSource</code> 对象具有一个或多个 <code>SourceBuffer</code> 对象。应用程序将数据段附加到 <code>SourceBuffer</code> 对象，并可以根据系统性能和其他因素调整附加数据的质量。来自 <code>SourceBuffer</code> 对象的数据被管理为用于解码和播放的音频，视频和文本数据的轨道缓冲器。</p><p><img src="https://www.w3.org/TR/media-source/pipeline_model.svg" alt="pipeline_model"></p><h3 id="html-的媒体支持浏览器兼容情况" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Supported_media_formats#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%83%85%E5%86%B5" target="_blank" rel="noopener noreferrer">HTML 的媒体支持浏览器兼容情况</a> <a class="header-anchor" href="#html-的媒体支持浏览器兼容情况" aria-hidden="true">#</a></h3><p><img src="https://img.cdn.jogiter.cn/public/blog/MSE-support.png" alt="Supported_media_formats#浏览器兼容情况"></p><p>判断给定的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener noreferrer">MIME 类型</a> 是否被当前的浏览器支持</p><div class="language-js"><pre><code><span class="token keyword">let</span> mimeCodec <span class="token operator">=</span> <span class="token string">&#39;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#39;</span>
<span class="token keyword">let</span> isMediaSourceSupported <span class="token operator">=</span>
  <span class="token string">&#39;MediaSource&#39;</span> <span class="token keyword">in</span> window <span class="token operator">&amp;&amp;</span> MediaSource<span class="token punctuation">.</span><span class="token function">isTypeSupported</span><span class="token punctuation">(</span>mimeCodec<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>isMediaSourceSupported<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> mediaSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Unsupported MIME type or codec: &#39;</span><span class="token punctuation">,</span> mimeCodec<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>MediaSource.isTypeSupported(&#39;mime; codecs=&quot;&quot;&#39;); 需要指定 codecs</p></blockquote><h3 id="transcoding" tabindex="-1">transcoding <a class="header-anchor" href="#transcoding" aria-hidden="true">#</a></h3><p>并非所有浏览器都支持所有编解码器，所以我们需要对资源进行转码。这里推荐使用 <a href="https://github.com/FFmpeg/FFmpeg" target="_blank" rel="noopener noreferrer">FFmpeg</a></p><div class="language-"><pre><code>ffmpeg -i input.wav output.mp3
ffmpeg -i input.y4m -i input.wav output.webm
</code></pre></div><h3 id="获取资源的-codecs-及资源碎片化" tabindex="-1">获取资源的 codecs 及资源碎片化 <a class="header-anchor" href="#获取资源的-codecs-及资源碎片化" aria-hidden="true">#</a></h3><p>下载 <a href="https://github.com/axiomatic-systems/Bento4" target="_blank" rel="noopener noreferrer">Bento4 </a></p><p>Bento4 SDK 包含几个使用 SDK API 构建的命令行应用程序/工具。这些包括：</p><table><thead><tr><th style="text-align:left;">程序名</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">mp4info</td><td style="text-align:left;">显示有关 MP4 文件的高级信息，包括所有曲目和编解码器详细信息</td></tr><tr><td style="text-align:left;">mp4dump</td><td style="text-align:left;">显示 MP4 文件的整个原子/框结构</td></tr><tr><td style="text-align:left;">mp4fragment</td><td style="text-align:left;">从非碎片文件创建碎片化 MP4 文件或重新碎片已碎片化的文件</td></tr><tr><td style="text-align:left;">mp4split</td><td style="text-align:left;">将碎片化的 MP4 文件拆分为离散文件</td></tr></tbody></table><p>查看资源的 Codecs</p><div class="language-"><pre><code>./mp4info.exe src/pirates.mp4 | grep Codecs
#   Codecs String: mp4a.40.2
#   Codecs String: avc1.4D401F
</code></pre></div><p>那么 mimeCodec = &#39;avc1.4D401F, mp4a.40.2&#39;</p><p>查看资源碎片化状态</p><div class="language-"><pre><code>./mp4info.exe ./src/pirates.mp4 | grep fragments
#fragments:  no
</code></pre></div><p>资源碎片化</p><div class="language-"><pre><code>./mp4fragment.exe src/pirates.mp4 src/pirates_fragment.mp4
#found regular I-frame interval: 17496 frames (at 23.976 frames per second)
#auto-detected fragment duration too large, using default
</code></pre></div><p>再次查看资源碎片化状态</p><div class="language-"><pre><code>./mp4info.exe ./src/pirates_fragmented.mp4 | grep fragments

#fragments:  yes
#    sample count with fragments: 61991
#    duration with fragments:     63478784
#    duration with fragments:     1439428 (ms)
#    sample count with fragments: 34511
#    duration with fragments:     69091022
#    duration with fragments:     1439396 (ms)
</code></pre></div><h3 id="使用-mse-播放二进制数据流" tabindex="-1">使用 MSE 播放二进制数据流 <a class="header-anchor" href="#使用-mse-播放二进制数据流" aria-hidden="true">#</a></h3><ul><li><a href="http://nickdesaulniers.github.io/netfix/demo/bufferAll.html" target="_blank" rel="noopener noreferrer">DEMO: BUFFER ASAP</a></li><li><a href="http://nickdesaulniers.github.io/netfix/demo/bufferWhenNeeded.html" target="_blank" rel="noopener noreferrer">DEMO: BUFFER JUST IN TIME</a></li></ul><div class="language-js"><pre><code><span class="token keyword">var</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;video&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> assetURL <span class="token operator">=</span> <span class="token string">&#39;frag_bunny.mp4&#39;</span>
<span class="token comment">// Need to be specific for Blink regarding codecs</span>
<span class="token comment">// ./mp4info frag_bunny.mp4 | grep Codec</span>
<span class="token keyword">var</span> mimeCodec <span class="token operator">=</span> <span class="token string">&#39;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#39;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;MediaSource&#39;</span> <span class="token keyword">in</span> window <span class="token operator">&amp;&amp;</span> MediaSource<span class="token punctuation">.</span><span class="token function">isTypeSupported</span><span class="token punctuation">(</span>mimeCodec<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> mediaSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//console.log(mediaSource.readyState); // closed</span>
  video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>mediaSource<span class="token punctuation">)</span>
  mediaSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;sourceopen&#39;</span><span class="token punctuation">,</span> sourceOpen<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Unsupported MIME type or codec: &#39;</span><span class="token punctuation">,</span> mimeCodec<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sourceOpen</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//console.log(this.readyState); // open</span>
  <span class="token keyword">var</span> mediaSource <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">var</span> sourceBuffer <span class="token operator">=</span> mediaSource<span class="token punctuation">.</span><span class="token function">addSourceBuffer</span><span class="token punctuation">(</span>mimeCodec<span class="token punctuation">)</span>
  <span class="token function">fetchAB</span><span class="token punctuation">(</span>assetURL<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">buf</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sourceBuffer<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;updateend&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mediaSource<span class="token punctuation">.</span><span class="token function">endOfStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">//console.log(mediaSource.readyState); // ended</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    sourceBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fetchAB</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&#39;arraybuffer&#39;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>替换本地资源后，报 MediaSource 错误：</p><blockquote><p>Uncaught DOMException: Failed to execute &#39;endOfStream&#39; on &#39;MediaSource&#39;: The MediaSource&#39;s readyState is not &#39;open&#39;.</p></blockquote><p>原因是因为视频资源不是 <code>fragmented </code>，需要进行转换，操作流程参考上一节。</p><h3 id="注意" tabindex="-1">注意 <a class="header-anchor" href="#注意" aria-hidden="true">#</a></h3><ol><li>prevent-html5-video-from-being-downloaded-right-click-saved？</li></ol><p>最简单的方式移除视频标签的右键“保存”选项</p><div class="language-js"><pre><code><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#39;#videoElementID&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>This does not help however if JavaScript is disabled in the browser</p></blockquote><ol start="2"><li>Firefox 61 上报错(QuotaExceededError: The quota has been exceeded.)</li></ol><p>firefox 会限制 fragment 的大小。firefox 需要 fragment 小于 20M。chrome &amp; Edge 无限制.</p><h2 id="阅读链接" tabindex="-1">阅读链接 <a class="header-anchor" href="#阅读链接" aria-hidden="true">#</a></h2><ul><li>使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaSource" target="_blank" rel="noopener noreferrer">MediaSource</a> 播放视频</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener noreferrer">MIME 类型</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener noreferrer">Blob</a> Blob 对象表示一个不可变、原始数据的类文件对象。Blob 表示的不一定是 JavaScript 原生格式的数据。File 接口基于 Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件。</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File/Using_files_from_web_applications" target="_blank" rel="noopener noreferrer">Using files from web applications</a></li><li><a href="https://github.com/nickdesaulniers/netfix" target="_blank" rel="noopener noreferrer">Let&#39;s build a Netflix</a> 使用 MediaSource 播放视频 demo</li><li><a href="http://nickdesaulniers.github.io/netfix/#/" target="_blank" rel="noopener noreferrer">LET&#39;S MAKE A NETFLIX</a></li><li><a href="https://caniuse.com/#search=createObjectURL" target="_blank" rel="noopener noreferrer">caniuse: createObjectURL</a></li><li><a href="https://developers.google.com/web/updates/2017/09/autoplay-policy-changes" target="_blank" rel="noopener noreferrer">autoplay-policy-changes</a> 谷歌 66 版本自动播放政策更改</li><li><a href="https://stackoverflow.com/questions/9756837/prevent-html5-video-from-being-downloaded-right-click-saved" target="_blank" rel="noopener noreferrer">prevent-html5-video-from-being-downloaded-right-click-saved</a></li><li>谷歌浏览器中更改自动播放策略: <code>chrome://flags/#autoplay-policy</code></li><li><a href="http://postbird.gitee.io/postbirdmp4toblob/" target="_blank" rel="noopener noreferrer">Postbird-demo</a></li><li><a href="https://github.com/axiomatic-systems/Bento4" target="_blank" rel="noopener noreferrer">axiomatic-systems/Bento4</a> 全功能 MP4 格式和 MPEG DASH 库和工具</li><li><a href="https://chocolatey.org/packages?q=ffmpeg" target="_blank" rel="noopener noreferrer">ffmpeg</a> windows 上安装 ffmpeg</li><li><a href="https://www.w3.org/TR/media-source/" target="_blank" rel="noopener noreferrer">media-source</a> Media Source Extensions</li></ul></div></div><footer class="page-footer" data-v-1881bce0 data-v-001a5369><div class="edit" data-v-001a5369><div class="edit-link" data-v-001a5369 data-v-6dc6f5be><a class="link" href="https://github.com/Jogiter/jogiter.github.com/edit/vitepress/docs/tech/mediaSourceExtension.md" target="_blank" rel="noopener noreferrer" data-v-6dc6f5be>在GitHub上编辑此页面 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-6dc6f5be><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-001a5369><p class="last-updated" data-v-001a5369 data-v-6a1b94eb><span class="prefix" data-v-6a1b94eb>最后更新:</span><span class="datetime" data-v-6a1b94eb></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"about_index.md\":\"d55595f5\",\"emotion_当人们让你失望时，有6种方法可以照顾好自己.md\":\"7dfa4c4f\",\"essay_books-to-read.md\":\"b6f41046\",\"essay_rework.md\":\"7eb94c11\",\"essay_the-21-laws-of-leadership.md\":\"967cb692\",\"index.md\":\"7f17cfc4\",\"reading_index.md\":\"a0513ac5\",\"tech_aigc视频字幕.md\":\"871ee7c6\",\"tech_ddd.md\":\"bb89399c\",\"tech_nodejs-权威指南.md\":\"7660e35a\",\"tech_typescript-guides.md\":\"1ea40208\",\"tech_eventloop-task-and-microtasks.md\":\"3c630f35\",\"tech_fetch-api.md\":\"7095eb06\",\"tech_ffmpeg.md\":\"6069ea4f\",\"tech_font-face.md\":\"1a828ba5\",\"tech_frontend-optimization.md\":\"96710ebb\",\"tech_git-tutorial.md\":\"3bd599b0\",\"tech_higher-order-function.md\":\"24ed6853\",\"tech_i18n.md\":\"a6186cce\",\"tech_index.md\":\"5cccff1b\",\"tech_jsonp-vs-cors.md\":\"d48e5903\",\"tech_lerna-with-tsdx.md\":\"8042ae6c\",\"tech_macbook-开发环境配置.md\":\"98c14f2b\",\"tech_markdown 解析及语法高亮调研.md\":\"ec8b4dc8\",\"tech_mediasourceextension.md\":\"6e13e86e\",\"tech_nest.js and typeorm.md\":\"75fed2f2\",\"tech_pwa.md\":\"def529c2\",\"tech_string-compare.md\":\"e1abbf7e\",\"tech_taro 小程序开发入门指北.md\":\"2ca8479c\",\"tech_tdd.md\":\"4a5984e7\",\"tech_using-virtualbox-test-old-ie.md\":\"0eab56d5\",\"tech_vue2-composition-api-faq.md\":\"ff0d1c27\",\"tech_webpack-config.md\":\"65485614\",\"tech_webrtc.md\":\"e50576f2\",\"tech_wechat-save-and-share-image.md\":\"3e87f2ee\",\"tech_【译】centos 8 服务器初始化设置.md\":\"ef4643d0\",\"tech_【译】什么是 web3.md\":\"830bb3cb\",\"tech_【译】在-centeros8-上部署node-js应用程序.md\":\"f64f4864\",\"tech_【转】javascript中的8种常见数据结构.md\":\"5d216184\",\"tech_使用-uni-app-开发小程序.md\":\"e7f78bbd\",\"tech_博客添加docsearch.md\":\"ca15e5df\",\"tech_打造舒适高效的前端开发环境.md\":\"cbd52576\",\"tech_搭建私有-npm.md\":\"71461f0c\",\"tech_移动端适配.md\":\"48d0a999\"}")</script>
    <script type="module" async src="/assets/app.9366d4db.js"></script>
    
  </body>
</html>