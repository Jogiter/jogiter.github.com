<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建私有 npm | Jogiter`s mind</title>
    <meta name="description" content="EveryThing about Me!">
    <link rel="stylesheet" href="/assets/style.d7f2fbcd.css">
    <link rel="modulepreload" href="/assets/plugin-vue_export-helper.71bb0c0b.js">
    <link rel="modulepreload" href="/assets/Home.4b66fb27.js">
    <link rel="modulepreload" href="/assets/AlgoliaSearchBox.4fd3e7bf.js">
    <link rel="modulepreload" href="/assets/tech_搭建私有-npm.md.71461f0c.lean.js">
    <link rel="modulepreload" href="/assets/app.9366d4db.js">
    <meta name="twitter:title" content="搭建私有 npm | Jogiter`s mind">
    <meta property="og:title" content="搭建私有 npm | Jogiter`s mind">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7b01b921><div class="sidebar-button" data-v-7b01b921><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Jogiter`s mind, back to home" data-v-7b01b921 data-v-19158655><!----> Jogiter`s mind</a><div class="flex-grow" data-v-7b01b921></div><div class="nav" data-v-7b01b921><nav class="nav-links" data-v-7b01b921 data-v-043d24b5><!--[--><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/about/" data-v-33cbaa06>个人简介 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/reading/" data-v-33cbaa06>Awesome 学习链接 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>杂文</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/books-to-read" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>books-to-read</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/rework" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>rework</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/the-21-laws-of-leadership" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>the-21-laws-of-leadership</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>情感</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/emotion/当人们让你失望时，有6种方法可以照顾好自己" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>当人们让你失望时，有6种方法可以照顾好自己</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>社交账号</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="https://github.com/Jogiter" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>Github</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="mailto:jogiter.g@gmail.com" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>邮箱</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item isExternal" href="https://github.com/Jogiter/jogiter.github.com" target="_blank" rel="noopener noreferrer" data-v-33cbaa06>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-33cbaa06><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-219eda98><nav class="nav-links nav" data-v-219eda98 data-v-043d24b5><!--[--><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/about/" data-v-33cbaa06>个人简介 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item" href="/reading/" data-v-33cbaa06>Awesome 学习链接 <!----></a></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>杂文</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/books-to-read" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>books-to-read</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/rework" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>rework</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/essay/the-21-laws-of-leadership" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>the-21-laws-of-leadership</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>情感</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item" href="/emotion/当人们让你失望时，有6种方法可以照顾好自己" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>当人们让你失望时，有6种方法可以照顾好自己</span><span class="icon" data-v-9e81def8><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-043d24b5><div class="nav-dropdown-link" data-v-043d24b5 data-v-15a3fdea><button class="button" data-v-15a3fdea><span class="button-text" data-v-15a3fdea>社交账号</span><span class="right button-arrow" data-v-15a3fdea></span></button><ul class="dialog" data-v-15a3fdea><!--[--><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="https://github.com/Jogiter" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>Github</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-15a3fdea><div class="nav-dropdown-link-item" data-v-15a3fdea data-v-9e81def8><a class="item isExternal" href="mailto:jogiter.g@gmail.com" target="_blank" rel="noopener noreferrer" data-v-9e81def8><span class="arrow" data-v-9e81def8></span><span class="text" data-v-9e81def8>邮箱</span><span class="icon" data-v-9e81def8><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-9e81def8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-043d24b5><div class="nav-link" data-v-043d24b5 data-v-33cbaa06><a class="item isExternal" href="https://github.com/Jogiter/jogiter.github.com" target="_blank" rel="noopener noreferrer" data-v-33cbaa06>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-33cbaa06><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-219eda98><!--[--><li class="sidebar-link"><p class="sidebar-link-item">文章</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/AIGC视频字幕">AIGC视频字幕</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/DDD">DDD</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/Nodejs-权威指南">Nodejs-权威指南</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/Typescript-guides">Typescript-guides</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/eventloop-task-and-microtasks">eventloop-task-and-microtasks</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/fetch-API">fetch-API</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/ffmpeg">ffmpeg</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/font-face">font-face</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/frontend-optimization">frontend-optimization</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/git-tutorial">git-tutorial</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/higher-order-function">higher-order-function</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/i18n">i18n</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/jsonp-vs-cors">jsonp-vs-cors</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/lerna-with-tsdx">lerna-with-tsdx</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/macbook-开发环境配置">macbook-开发环境配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/markdown 解析及语法高亮调研">markdown 解析及语法高亮调研</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/mediaSourceExtension">mediaSourceExtension</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/nest.js and typeOrm">nest.js and typeOrm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/pwa">pwa</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/string-compare">string-compare</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/taro 小程序开发入门指北">taro 小程序开发入门指北</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/tdd">tdd</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/using-virtualbox-test-old-ie">using-virtualbox-test-old-ie</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/vue2-composition-api-faq">vue2-composition-api-faq</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/webpack-config">webpack-config</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/webrtc">webrtc</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/wechat-save-and-share-image">wechat-save-and-share-image</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】CentOS 8 服务器初始化设置">【译】CentOS 8 服务器初始化设置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】什么是 Web3">【译】什么是 Web3</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【译】在-centeros8-上部署Node-js应用程序">【译】在-centeros8-上部署Node-js应用程序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/【转】Javascript中的8种常见数据结构">【转】Javascript中的8种常见数据结构</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/使用-uni-app-开发小程序">使用-uni-app-开发小程序</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/博客添加docSearch">博客添加docSearch</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/打造舒适高效的前端开发环境">打造舒适高效的前端开发环境</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/搭建私有-npm">搭建私有-npm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/tech/移动端适配">移动端适配</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-1881bce0><div class="container" data-v-1881bce0><!--[--><!--]--><div style="position:relative;" class="content" data-v-1881bce0><div><h1 id="frontmatter-title" tabindex="-1">搭建私有 npm <a class="header-anchor" href="#frontmatter-title" aria-hidden="true">#</a></h1><p><div class="table-of-contents"><ul><li><a href="#使用-verdaccio">使用 verdaccio</a><ul><li><a href="#install">Install</a></li><li><a href="#nginx-setting">Nginx setting</a></li><li><a href="#keeping-verdaccio-running-forever">Keeping verdaccio running forever</a></li><li><a href="#本地配置-registry">本地配置 registry</a></li><li><a href="#发布和安装私有包">发布和安装私有包</a></li></ul></li><li><a href="#使用-cnpmjs-org">使用 cnpmjs.org</a><ul><li><a href="#dependencies">Dependencies</a></li><li><a href="#install">Install</a></li></ul></li><li><a href="#difference">difference</a></li><li><a href="#readings">Readings</a></li></ul></div></p><p>目前有以下两种推荐方案：</p><h2 id="使用-verdaccio" tabindex="-1">使用 <code>verdaccio</code> <a class="header-anchor" href="#使用-verdaccio" aria-hidden="true">#</a></h2><p><a href="https://github.com/verdaccio/verdaccio" target="_blank" rel="noopener noreferrer">verdaccio</a>: A lightweight private npm proxy registry</p><h3 id="install" tabindex="-1">Install <a class="header-anchor" href="#install" aria-hidden="true">#</a></h3><p>在服务器上全局安装 <code>verdaccio</code></p><div class="language-"><pre><code>$ npm install -g verdaccio
$ verdaccio
warn --- config file - /home/.config/verdaccio/config.yaml
warn --- http address - http://localhost:4873/ - verdaccio/3.0.0
</code></pre></div><h3 id="nginx-setting" tabindex="-1">Nginx setting <a class="header-anchor" href="#nginx-setting" aria-hidden="true">#</a></h3><p>为了不和其他的 <code>ginx</code>配置冲突，我们将 <code>verdaccio</code> 的默认端口指向服务器的子目录 <code>/verdaccio/</code> 下</p><div class="language-"><pre><code>server {
  listen       80;
  server_name  host;

  location ~ ^/verdaccio/(.*)$ {
    proxy_pass http://127.0.0.1:4873/$1;
    proxy_set_header Host            $host:$server_port;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
</code></pre></div><p>同时我们还需要修改 <code>verdaccio</code> 的配置文件 <code>~/.config/verdaccio/config.yaml</code>，更多<a href="https://verdaccio.org/docs/en/configuration" target="_blank" rel="noopener noreferrer">配置参考</a></p><div class="language-"><pre><code>url_prefix:  /verdaccio/
</code></pre></div><ul><li><code>~/.config/verdaccio/storage</code> ：储存发布和缓存的包，会缓存下载的包</li><li><code>~/.config/verdaccio/htpasswd</code> ：储存注册用户的账号名和密码</li></ul><h3 id="keeping-verdaccio-running-forever" tabindex="-1">Keeping verdaccio running forever <a class="header-anchor" href="#keeping-verdaccio-running-forever" aria-hidden="true">#</a></h3><p>You can use node package called <a href="https://github.com/nodejitsu/forever" target="_blank" rel="noopener noreferrer">&#39;forever&#39;</a> to keep <code>verdaccio</code> running all the time.</p><p>First install <code>forever</code> globally:</p><div class="language-bash"><pre><code>$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> forever
</code></pre></div><p>Make sure you&#39;ve run <code>verdaccio</code> at least once to generate the config file and write down the created admin user. You can then use the following command to start <code>verdaccio</code>:</p><div class="language-bash"><pre><code>$ forever start <span class="token variable"><span class="token variable">`</span><span class="token function">which</span> verdaccio<span class="token variable">`</span></span>
</code></pre></div><p>You can check the documentation for more information on how to use forever.</p><h4 id="surviving-server-restarts" tabindex="-1">Surviving server restarts <a class="header-anchor" href="#surviving-server-restarts" aria-hidden="true">#</a></h4><p>You can use <code>crontab</code> and <code>forever</code> together to start <code>verdaccio</code> after a server reboot. When you&#39;re logged in as the <code>verdaccio</code> user do the following:</p><div class="language-bash"><pre><code>$ <span class="token function">crontab</span> <span class="token parameter variable">-e</span>
</code></pre></div><p>This might ask you to choose an editor. Pick your favorite and proceed. Add the following entry to the file:</p><pre><code>@reboot /usr/bin/forever start /usr/lib/node_modules/verdaccio/bin/verdaccio
</code></pre><p>The locations may vary depending on your server setup. If you want to know where your files are you can use the &#39;which&#39; command:</p><div class="language-bash"><pre><code>$ <span class="token function">which</span> forever
$ <span class="token function">which</span> verdaccio
</code></pre></div><h3 id="本地配置-registry" tabindex="-1">本地配置 registry <a class="header-anchor" href="#本地配置-registry" aria-hidden="true">#</a></h3><p>推荐安装 <a href="https://github.com/Pana/nrm" target="_blank" rel="noopener noreferrer">nrm</a> 来管理 registry</p><div class="language-bash"><pre><code>$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> nrm
$ nrm <span class="token function">add</span> knpm http://host/verdaccio/
$ nrm use knpm
</code></pre></div><h3 id="发布和安装私有包" tabindex="-1">发布和安装私有包 <a class="header-anchor" href="#发布和安装私有包" aria-hidden="true">#</a></h3><div class="language-bash"><pre><code>$ <span class="token function">npm</span> publish @private/util
$ <span class="token function">npm</span> <span class="token function">install</span> @vue/cli
</code></pre></div><hr><h2 id="使用-cnpmjs-org" tabindex="-1">使用 <code>cnpmjs.org</code> <a class="header-anchor" href="#使用-cnpmjs-org" aria-hidden="true">#</a></h2><p><a href="https://github.com/cnpm/cnpmjs.org" target="_blank" rel="noopener noreferrer">cnpmjs.org</a>: Private npm registry and web for Enterprise, base on <a href="http://koajs.com/" target="_blank" rel="noopener noreferrer">koa</a>, MySQL and <a href="https://github.com/cnpm/cnpmjs.org/wiki/NFS-Guide" target="_blank" rel="noopener noreferrer">Simple Store Service</a>.</p><h3 id="dependencies" tabindex="-1">Dependencies <a class="header-anchor" href="#dependencies" aria-hidden="true">#</a></h3><ul><li>Node &gt;= 6.11.3</li><li>MySQL &gt;= 0.5.0, include <code>mysqld</code> and <code>mysql</code> cli</li><li><s><a href="https://github.com/cnpm/cnpmjs.org/wiki/NFS-Guide" target="_blank" rel="noopener noreferrer">Simple File Store Service, like qiniu, aliyun-oss, tfs, upyun</a></s></li></ul><h3 id="install-1" tabindex="-1">Install <a class="header-anchor" href="#install-1" aria-hidden="true">#</a></h3><ol><li>Get the Code</li></ol><div class="language-shell"><pre><code><span class="token comment"># clone from github</span>
$ <span class="token function">git</span> clone git://github.com/cnpm/cnpmjs.org.git <span class="token environment constant">$HOME</span>/cnpmjs.org
$ <span class="token builtin class-name">cd</span> <span class="token environment constant">$HOME</span>/cnpmjs.org
</code></pre></div><p>Install <code>cnpmjs.org</code> and <code>cnpm</code> from npm</p><div class="language-"><pre><code>$ npm install -g --build-from-source cnpmjs.org cnpm sqlite3
</code></pre></div><p>If you&#39;re in China, maybe you should use China mirror</p><div class="language-shell"><pre><code>$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> --build-from-source <span class="token punctuation">\</span>
  <span class="token parameter variable">--registry</span><span class="token operator">=</span>https://registry.npm.taobao.org <span class="token punctuation">\</span>
  <span class="token parameter variable">--disturl</span><span class="token operator">=</span>https://npm.taobao.org/mirrors/node <span class="token punctuation">\</span>
  cnpmjs.org cnpm sqlite3
</code></pre></div><ol><li><code>mysql</code> 数据库操作：</li></ol><p>a. 创建数据库 <code>private-npm</code>：</p><div class="language-sql"><pre><code><span class="token keyword">create</span> <span class="token keyword">database</span> private<span class="token operator">-</span>npm
</code></pre></div><p>b. 创建表：<a href="https://github.com/cnpm/cnpmjs.org/blob/master/docs/db.sql" target="_blank" rel="noopener noreferrer">Get all the sqls here</a></p><blockquote><p><a href="http://www.ifepoland.com/lilip/p/10109557.html" target="_blank" rel="noopener noreferrer">mysql 8.0 创建 table 时报错:【MYSQL】MYSQL 报错解决方法： Warning: (3719, &quot;&#39;utf8&#39; is currently an alias for the character set UTF8MB3, but will be an alias for UTF8M B4 in a future release.&quot;</a></p></blockquote><ol start="3"><li>Edit Your Own Config File</li></ol><div class="language-"><pre><code>$ cd $HOME/cnpmjs.org
$ vim config/index.js
</code></pre></div><div class="language-js"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">enableCluster</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// enable cluster mode</span>
  <span class="token literal-property property">enablePrivate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// enable private mode, only admin can publish, other use just can sync package from source npm</span>
  <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">db</span><span class="token operator">:</span> <span class="token string">&#39;private-npm&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">// the sql dialect of the database</span>
    <span class="token comment">// - currently supported: &#39;mysql&#39;, &#39;sqlite&#39;, &#39;postgres&#39;, &#39;mariadb&#39;</span>
    <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">// custom host; default: 127.0.0.1</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">// custom port; default: 3306</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>

    <span class="token literal-property property">ssl</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">ca</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dataDir<span class="token punctuation">,</span> <span class="token string">&#39;certs/mysql-test.pem&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// use pooling in order to reduce db connection overload and to increase speed</span>
    <span class="token comment">// currently only for mysql and postgresql (since v1.5.0)</span>
    <span class="token literal-property property">pool</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">maxConnections</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minConnections</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxIdleTime</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token literal-property property">dialectOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">trace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// the storage engine for &#39;sqlite&#39;</span>
    <span class="token comment">// default store into ~/.cnpmjs.org/data.sqlite</span>
    <span class="token literal-property property">storage</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dataDir<span class="token punctuation">,</span> <span class="token string">&#39;data.sqlite&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token literal-property property">logging</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SQL_DEBUG</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">admins</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">admin</span><span class="token operator">:</span> <span class="token string">&#39;admin@cnpmjs.org&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// registry scopes, if don&#39;t set, means do not support scopes</span>
  <span class="token literal-property property">scopes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@knpm&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;@knpmtest&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;@knpm-test&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// &#39;none&#39;: 永不同步，只管理私有用户上传的包，其它源包会直接从源站获取</span>
  <span class="token comment">// &#39;exist&#39;: 定时同步已经存在于数据库的包</span>
  <span class="token comment">// &#39;all&#39;: 定时同步所有源站的</span>
  <span class="token literal-property property">syncModel</span><span class="token operator">:</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">,</span> <span class="token comment">// &#39;none&#39;, &#39;all&#39;, &#39;exist&#39;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意这里的 <code>mysql</code> 的连接使用测试环境的 <code>mysql</code>，采用 <code>ssl</code> 的方式进行连接，因此还需要添加 <code>ssl</code> 配置。</p><blockquote><p>详细配置参考<a href="https://medoc.000webhostapp.com/2018/04/19/npm%E7%A7%81%E5%BA%93%E6%90%AD%E5%BB%BA-cnpm-js/" target="_blank" rel="noopener noreferrer">配置字段参考</a></p></blockquote><ol start="4"><li>添加 <code>ssl</code> 文件，同时将 <code>key</code> 内容拷贝到 <code>~/.cnpmjs.org/certs/mysql-test.pem</code> 文件。具体的 <code>key</code> 请咨询测试同事。</li></ol><div class="language-"><pre><code>$ cd ~/.cnpmjs.org/
$ mkdir certs
$ touch mysql-test.pem
</code></pre></div><ul><li><code>~/.cnpmjs.org/nfs</code> ：默认储存发布和缓存的包，可设置不缓存下载的包。具体请参考配置参考。</li></ul><ol start="5"><li>开启服务</li></ol><div class="language-"><pre><code>$ cd ~/cnpmjs.org/
$ npm run start
</code></pre></div><p><code>registry</code>：<a href="http://localhost:7001" target="_blank" rel="noopener noreferrer">http://localhost:7001</a><code>web</code>：<a href="http://localhost:7002" target="_blank" rel="noopener noreferrer">http://localhost:7002</a></p><p>配置 <code>Nginx</code></p><div class="language-"><pre><code>$ cd /etc/nginx/
$ vim nginx.conf
</code></pre></div><p><code>Nginx</code> 设置</p><pre><code>server {
  listen       80;
  server_name  host;

  location ~ ^/knpm/(.*)$ {
    proxy_pass http://127.0.0.1:7001/$1;
    proxy_set_header Host            $host:$server_port;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
  location / {
    proxy_pass http://127.0.0.1:7002/;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host  $http_host;
    proxy_set_header X-Nginx-Proxy true;
    proxy_http_version 1.1;
    proxy_set_header Connection &quot;&quot;;
  }
}
</code></pre><ol start="6"><li>本地环境设置 <code>registry</code></li></ol><div class="language-"><pre><code>$ cnpm set registry http://host/knpm/
</code></pre></div><p>发布和安装包</p><div class="language-"><pre><code>$ cnpm login
$ cnpm publish
$ cnpm install
</code></pre></div><ol start="7"><li>个性化配置 <code>npm</code> ，详细请阅读项目源码~</li></ol><div class="language-"><pre><code>$ cd ~/cnpmjs.org/
</code></pre></div><h2 id="difference" tabindex="-1">difference <a class="header-anchor" href="#difference" aria-hidden="true">#</a></h2><ul><li>verdaccio <ul><li>安装简单，不需要数据库支持</li><li>设置 <code>registry</code> 后通过 <code>npm</code> 来进行包管理</li><li>可配置性低；服务器会储存所有的包，包括发布的私语包和下载的包</li><li>定制化页面需要修改全局安装的源码</li></ul></li><li><a href="http://cnpmjs.org" target="_blank" rel="noopener noreferrer">cnpmjs.org</a><ul><li>安装复杂，需要安装 <code>mysql</code></li><li>设置 <code>registry</code> 后通过 <code>cnpm</code> 来进行包管理</li><li>高度可配置；支持服务器只存储发布的私有包</li><li>定制化页面需要修改部署安装的源码</li></ul></li></ul><h2 id="readings" tabindex="-1">Readings <a class="header-anchor" href="#readings" aria-hidden="true">#</a></h2><ul><li><a href="https://verdaccio.org/docs/en/installation" target="_blank" rel="noopener noreferrer">verdaccio 安装</a></li><li><a href="https://github.com/cnpm/cnpmjs.org/wiki/Deploy-a-private-npm-registry-in-5-minutes" target="_blank" rel="noopener noreferrer">Deploy a private npm registry in 5 minutes</a></li><li><a href="https://github.com/jaywcjlove/handbook/blob/master/CentOS/%E5%9C%A85%E5%88%86%E9%92%9F%E5%86%85%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E5%86%85%E9%83%A8%E7%A7%81%E6%9C%89npm%E4%BB%93%E5%BA%93.md" target="_blank" rel="noopener noreferrer">在 5 分钟内搭建企业内部私有 npm 仓库</a></li></ul></div></div><footer class="page-footer" data-v-1881bce0 data-v-001a5369><div class="edit" data-v-001a5369><div class="edit-link" data-v-001a5369 data-v-6dc6f5be><a class="link" href="https://github.com/Jogiter/jogiter.github.com/edit/vitepress/docs/tech/搭建私有-npm.md" target="_blank" rel="noopener noreferrer" data-v-6dc6f5be>在GitHub上编辑此页面 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-6dc6f5be><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-001a5369><p class="last-updated" data-v-001a5369 data-v-6a1b94eb><span class="prefix" data-v-6a1b94eb>最后更新:</span><span class="datetime" data-v-6a1b94eb></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"about_index.md\":\"d55595f5\",\"emotion_当人们让你失望时，有6种方法可以照顾好自己.md\":\"7dfa4c4f\",\"essay_books-to-read.md\":\"b6f41046\",\"essay_rework.md\":\"7eb94c11\",\"essay_the-21-laws-of-leadership.md\":\"967cb692\",\"index.md\":\"7f17cfc4\",\"reading_index.md\":\"a0513ac5\",\"tech_aigc视频字幕.md\":\"871ee7c6\",\"tech_ddd.md\":\"bb89399c\",\"tech_nodejs-权威指南.md\":\"7660e35a\",\"tech_typescript-guides.md\":\"1ea40208\",\"tech_eventloop-task-and-microtasks.md\":\"3c630f35\",\"tech_fetch-api.md\":\"7095eb06\",\"tech_ffmpeg.md\":\"6069ea4f\",\"tech_font-face.md\":\"1a828ba5\",\"tech_frontend-optimization.md\":\"96710ebb\",\"tech_git-tutorial.md\":\"3bd599b0\",\"tech_higher-order-function.md\":\"24ed6853\",\"tech_i18n.md\":\"a6186cce\",\"tech_index.md\":\"5cccff1b\",\"tech_jsonp-vs-cors.md\":\"d48e5903\",\"tech_lerna-with-tsdx.md\":\"8042ae6c\",\"tech_macbook-开发环境配置.md\":\"98c14f2b\",\"tech_markdown 解析及语法高亮调研.md\":\"ec8b4dc8\",\"tech_mediasourceextension.md\":\"6e13e86e\",\"tech_nest.js and typeorm.md\":\"75fed2f2\",\"tech_pwa.md\":\"def529c2\",\"tech_string-compare.md\":\"e1abbf7e\",\"tech_taro 小程序开发入门指北.md\":\"2ca8479c\",\"tech_tdd.md\":\"4a5984e7\",\"tech_using-virtualbox-test-old-ie.md\":\"0eab56d5\",\"tech_vue2-composition-api-faq.md\":\"ff0d1c27\",\"tech_webpack-config.md\":\"65485614\",\"tech_webrtc.md\":\"e50576f2\",\"tech_wechat-save-and-share-image.md\":\"3e87f2ee\",\"tech_【译】centos 8 服务器初始化设置.md\":\"ef4643d0\",\"tech_【译】什么是 web3.md\":\"830bb3cb\",\"tech_【译】在-centeros8-上部署node-js应用程序.md\":\"f64f4864\",\"tech_【转】javascript中的8种常见数据结构.md\":\"5d216184\",\"tech_使用-uni-app-开发小程序.md\":\"e7f78bbd\",\"tech_博客添加docsearch.md\":\"ca15e5df\",\"tech_打造舒适高效的前端开发环境.md\":\"cbd52576\",\"tech_搭建私有-npm.md\":\"71461f0c\",\"tech_移动端适配.md\":\"48d0a999\"}")</script>
    <script type="module" async src="/assets/app.9366d4db.js"></script>
    
  </body>
</html>